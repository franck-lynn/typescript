# urql 发送 graphql请求

在前后端分离的项目中, 总有一些请求是每次都要发送的, 可以作为全局的请求信息进行发送.

新建 urql/index.ts 文件

```ts
import { createClient } from "@urql/vue"
// import Cookies from "js-cookie"

import { HOST_NAME, PORT } from "../constants"

const client = createClient({
  url: `${HOST_NAME}:${PORT}/graphql`,
  fetchOptions: () => {
    // 令牌是放在 cookie 里面, 可以从 cookie 里拿
    // const token = Cookies.get("token") || "Bearer xxxx "
    const token = "xxxx bbbbbb "
    return {
      headers: { authorization: token ? `Bearer ${token}` : "" },
    }
  },
})

export default client
```

在 src/main.ts 中增加

```ts
import { createApp } from "vue"
import router from "./routers"

import urql from "@urql/vue" // 增加
import client from "./urql" // 增加

import App from "./App.vue"

const app = createApp(App)
app.use(urql, client) // 增加

app.use(router)  
app.mount("#root")
```

这里用到了环境变量,  浏览器会报  

```bash
Uncaught ReferenceError: process is not defined
```

错误. 解决这个错误是在 vite.config.ts 在定义

```ts
import dotenv from "dotenv"
// ******************* 环境变量 *************************
// https://cn.vitejs.dev/guide/env-and-mode.html#intellisense
// console.log("加载环境变量===> ", process.cwd()) // 这里 cwd 是可以加载的
// 通过下面这样可以指定环境变量文件的位置, 前后端都在同一个环境变量
let envs: dotenv.DotenvConfigOutput
try {
  if (process.cwd().includes("client")) {
    // 表示在 client 下启动 package.json,  向上一级查找, 在项目的根目录下 .env 文件
    envs = dotenv.config({ path: "../.env" })
  } else {
    envs = dotenv.config({ path: "./.env" })
  }
  for (const key in envs.parsed) {
    // https://blog.csdn.net/m0_67393593/article/details/123398483
    process.env[key] = envs.parsed[key]
  }
} catch (e) {
  console.error(e)
}

...
const config: UserConfig = {
  ...
  // https://cn.vitejs.dev/config/shared-options.html#define
  define: {
    "process.env": process.env,
  },
}
export default config
```

#### 请求测试需要配置服务器

接下来配置服务器



在浏览器中, 查看 network 中 graphql, 可以看到, 请求头中

```html
authorization: Bearer xxxx bbbbbb
```

