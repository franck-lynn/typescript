# 平移最简单的方案

1.  首先, 设置元素的定位 为绝对定位, 因为相对定位可能移动不了

2. 在鼠标按下时, 记录此时的坐标位置并保存起来

```ts
const a = e.clientX
const b = e.clientY
```

3. 获取要移动的元素的 left, top

```ts
const a = e.clientX
const b = e.clientY
const { left, top } = box1.getBoundingClientRect()
```

4. 要平移的点坐标, 要平移的点一般设置在定位的位置, 例如, 这里的 div 是靠 left, top 进行定位的, 所以, 要平移的点就是 

```ts
const p1 = { x: left, y: top }
```

5. 鼠标移动时监听新的坐标点 - 原理的鼠标坐标 = Δ鼠标位移

```ts
const dx = e.clientX - a
const dy = e.clientY - b
```

6. 现在, 就可以使用点的平移公式直接计算这个定位点就可以了

```ts
if (moving) {
    // 这个moved 函数里的公式是利用齐次坐标变换推导出来的, 直接使用就可以了
    const { x, y } = moved(p1, dx, dy)
    xx.value = x
    yy.value = y
}
```

完整的程序如下:

```ts
<script setup lang="ts">
import { ref, onMounted } from "vue"
const xx = ref(100)
const yy = ref(100)

type Point = {
  x: number
  y: number
}

const moved = (p1: Point, dx: number, dy: number) => ({
  x: p1.x + dx,
  y: p1.y + dy,
})

onMounted(() => {
  const box1 = document.querySelector(".move") as HTMLElement
  let moving = false

  box1.addEventListener("mousedown", (e) => {
    moving = true
    const a = e.clientX
    const b = e.clientY
    const { left, top } = box1.getBoundingClientRect()
    console.log(left, top)
    // 要平移的点
    const p1 = { x: left, y: top }
    document.addEventListener("mousemove", (e) => {
      const dx = e.clientX - a
      const dy = e.clientY - b
      if (moving) {
        const { x, y } = moved(p1, dx, dy)
        xx.value = x
        yy.value = y
      }
    })
    document.addEventListener("mouseup", () => {
      moving = false
    })
  })
})
</script>
<template>
  <div class="box1">
    <div ref="el" :style="`left: ${xx}px; top: ${yy}px`" class="move"></div>
  </div>
</template>

<style scoped>
.box1 {
  margin: 80px;
  width: 600px;
  height: 600px;
  border: 5px solid greenyellow;
}
.move {
  position: absolute;
  width: 200px;
  height: 200px;
  border-radius: 15px;
  background-color: red;
  box-shadow: 10px 10px 15px rgb(0 0 0 / 70%);
}
</style>

```

